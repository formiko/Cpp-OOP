# 第6章 多态性与虚函数
## 6.1 什么是多态性
* 多态性：向不同的对象发送同一个消息，不同的对象在接收时会产生不同的行为（即方法）。也就是说，每个对象都可以用自己的方式去响应共同的消息。所谓消息，就是调用函数，不同的行为就是指不同的实现，即执行不同的函数。
* 函数的重载、运算符重载都是多态现象。
* 在C++中，多态性表现形式之一是：具有不同功能的函数可以用同一个函数名，这样就可以用一个函数名调用不同内容的函数。
* 从系统实现的角度看，多态性分为两类：静态多态性和动态多态性。 
* 静态多态性是通过函数的重载实现的。静态多态性又称编译时多态性。
* 动态多态性的特点：不在编译时确定调用的是哪个函数，而是在程序运行过程中才动态地确定操作所针对的对象。它又称运行时的多态性。动态多态性是通过虚函数实现的。
## 6.2 一个典型的例子
## 6.3 利用虚函数实现动态多态性
### 6.3.1 虚函数的作用
* 虚函数的作用是允许在派生类中重新定义与基类同名的函数，并且可以通过基类指针或引用来访问基类和派生类中的同名函数。
* 虚函数的使用方法是：
	1. 在基类中用virtual声明成员函数为虚函数。在类外定义虚函数时，不必再加virtual
	2. 在派生类中重新定义此函数，函数名、函数类型、函数参数个数和类型必须与基类的虚函数相同，根据派生类的需要重新定义函数体。  
	   派生类声明该虚函数时，可以加virtual也可以不加，习惯上一般在每一层都加，使程序更清晰。
	3. 定义一个指向基类对象的指针变量，并使它指向同一类族中需要调用该函数的对象。
	4. 通过该指针变量调用此虚函数，此时调用的就是指针变量指向的对象的同名函数。
### 6.3.2 静态关联与动态关联
* 先定义了一个指向基类的指针变量，并使它指向相应的类对象，然后通过这个基类指针去调用虚函数（例如pt->display()）。显然，对这样的调用方式，编译系统在编译该行时是无法确定调用哪一个类对象的虚函数的。因为编译只作静态的语法检查，光从语句形式（例如“pt->display();”是无法确定调用哪个对象的。
* 由于是在运行阶段把虚函数和类对象“绑定”在一起的，因此，此过程称为动态关联。这种多态性是动态的多态性，即运行阶段的多态性。
### 6.3.3 在什么情况下应该声明虚函数
* 说明：使用虚函数，系统要有一定的空间开销。当一个类带有虚函数时，编译系统会为该类构造一个虚函数表（virtual function table，简称vtable），它是一个指针数组，存放每个虚函数的入口地址。
* 系统在进行动态关联时的时间开销是很少的，因此，多态性是高效的。
### 6.3.4 虚析构函数
* 背景：在程序用带指针参数的delete运算符撤销对象时，会发生一个情况：系统会只执行基类的析构函数，而不执行派生类的析构函数
* 当基类的析构函数为虚函数时，无论指针指的是同一类族的哪一个对象，系统都会采用动态关联，调用相应类的析构函数，对该对象进行清理工作。
* 如果将基类的析构函数声明为虚函数，由该基类所派生的所有派生类的析构函数也都自动成为虚函数
* 专业人员一般都习惯声明虚析构函数，即使基类并不需要析构函数，也显式地定义一个函数体为空的虚析构函数，以保证在撤销动态分配空间时能得到正确的处理。
## 6.4 纯虚函数与抽象类
### 6.4.1 纯虚函数
* 例子背景：例6.1程序中的Point类中没有定义area函数。但是，在其直接派生类Circle和间接派生类Cylinder中都需要有area函数，而且这两个area函数的功能不同。很自然，可以将area声明为虚函数。
* 声明纯虚函数的一般形式是：
	``` C++
	virtual 函数类型 函数名(参数表列)=0；
	```
* 纯虚函数没有函数体
* 纯虚函数声明的最后面的“=0”并不表示函数返回值为0，它只起形式上的作用，告诉编译系统“这是纯虚函数”
* 纯虚函数不能被调用
### 6.4.2 抽象类
* 抽象类：不用来定义对象而只作为一种基本类型用作继承的类，称为抽象类，由于它常用作基类，通常称为抽象基类。
* 凡是包含纯虚函数的类都是抽象类。因为纯虚函数时不能被调用的，包含纯虚函数的类是无法建立对象的。
* 由于在调用虚函数时，是在运行阶段才确定调用哪一个函数的，因此有可能在写程序时要调用某一类的虚函数，而该函数所在的类还未声明呢！
